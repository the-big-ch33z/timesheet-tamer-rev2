<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>timeflow-grid-manager</title>
    <meta name="description" content="Lovable Generated Project" />
    <meta name="author" content="Lovable" />

    <meta property="og:title" content="timeflow-grid-manager" />
    <meta property="og:description" content="Lovable Generated Project" />
    <meta property="og:type" content="website" />
    <meta property="og:image" content="https://lovable.dev/opengraph-image-p98pqg.png" />

    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:site" content="@lovable_dev" />
    <meta name="twitter:image" content="https://lovable.dev/opengraph-image-p98pqg.png" />
    
    <style>
      .diagnostic-screen {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: #0f1419;
        color: #ffffff;
        font-family: 'Courier New', monospace;
        padding: 20px;
        overflow-y: auto;
        z-index: 10000;
      }
      .status-line {
        margin: 8px 0;
        padding: 4px 8px;
        border-radius: 4px;
      }
      .status-success { background: #0d5016; color: #4ade80; }
      .status-error { background: #7f1d1d; color: #f87171; }
      .status-warning { background: #451a03; color: #fbbf24; }
      .status-info { background: #1e3a8a; color: #60a5fa; }
    </style>
  </head>

  <body>
    <!-- Diagnostic Screen -->
    <div id="diagnostic-screen" class="diagnostic-screen">
      <h1 style="color: #60a5fa; margin-bottom: 20px;">ğŸ” ES Module Cache Fix Test</h1>
      <div id="diagnostic-log"></div>
      <div style="margin-top: 20px;">
        <button id="test-original" style="background: #3b82f6; color: white; border: none; padding: 8px 16px; border-radius: 4px; margin-right: 10px;">
          ğŸ“‹ Test Original main.tsx
        </button>
        <button id="test-new" style="background: #059669; color: white; border: none; padding: 8px 16px; border-radius: 4px; margin-right: 10px;">
          ğŸ†• Test main-fixed.tsx
        </button>
        <button id="direct-load" style="background: #dc2626; color: white; border: none; padding: 8px 16px; border-radius: 4px;">
          ğŸš€ Direct Load
        </button>
      </div>
    </div>

    <!-- Main app container -->
    <div id="root"></div>

    <!-- Enhanced Diagnostic Script -->
    <script>
      console.log("=== CACHE FIX TEST START ===");
      
      const diagnosticLog = document.getElementById('diagnostic-log');
      let testResults = {};
      
      function addLog(message, type = 'info') {
        const logLine = document.createElement('div');
        logLine.className = `status-line status-${type}`;
        logLine.textContent = message;
        diagnosticLog.appendChild(logLine);
        console.log(`[${type.toUpperCase()}] ${message}`);
      }
      
      async function testFile(filepath, label) {
        addLog(`Testing ${label}: ${filepath}`, 'info');
        
        try {
          const response = await fetch(filepath + '?cache=' + Date.now());
          const content = await response.text();
          const contentType = response.headers.get('content-type');
          
          addLog(`âœ… ${label} - Size: ${content.length} chars, Type: ${contentType}`, 'success');
          
          if (content.includes('import React')) {
            addLog(`âœ… ${label} contains React imports`, 'success');
            return true;
          } else {
            addLog(`âŒ ${label} missing React imports`, 'error');
            return false;
          }
          
        } catch (error) {
          addLog(`âŒ ${label} failed: ${error.message}`, 'error');
          return false;
        }
      }
      
      async function directLoadModule(filepath) {
        addLog(`ğŸš€ Attempting direct module load: ${filepath}`, 'info');
        
        try {
          // Remove any existing scripts
          const existingScripts = document.querySelectorAll('script[src*="main"]');
          existingScripts.forEach(script => script.remove());
          
          // Create new script with cache busting
          const script = document.createElement('script');
          script.type = 'module';
          script.src = filepath + '?t=' + Date.now();
          
          script.onload = () => {
            addLog(`âœ… Module loaded successfully from ${filepath}!`, 'success');
            setTimeout(() => {
              document.getElementById('diagnostic-screen').style.display = 'none';
            }, 2000);
          };
          
          script.onerror = (e) => {
            addLog(`âŒ Module load failed: ${e.message || 'Unknown error'}`, 'error');
          };
          
          document.head.appendChild(script);
          
        } catch (error) {
          addLog(`âŒ Direct load error: ${error.message}`, 'error');
        }
      }
      
      // Button handlers
      document.getElementById('test-original').addEventListener('click', () => {
        testFile('/src/main.tsx', 'Original main.tsx');
      });
      
      document.getElementById('test-new').addEventListener('click', () => {
        testFile('/src/main-fixed.tsx', 'New main-fixed.tsx');
      });
      
      document.getElementById('direct-load').addEventListener('click', async () => {
        addLog('ğŸ” Testing both files first...', 'info');
        
        const originalWorks = await testFile('/src/main.tsx', 'Original');
        const newWorks = await testFile('/src/main-fixed.tsx', 'New file');
        
        if (originalWorks) {
          addLog('ğŸ“‹ Original file works, loading it...', 'info');
          directLoadModule('/src/main.tsx');
        } else if (newWorks) {
          addLog('ğŸ†• New file works, loading it...', 'info');
          directLoadModule('/src/main-fixed.tsx');
        } else {
          addLog('âŒ Neither file contains proper content', 'error');
          addLog('ğŸ’¡ Try making a small edit to main.tsx in Lovable editor', 'warning');
        }
      });
      
      // Auto-run initial test
      addLog('ğŸ” Running initial cache test...', 'info');
      setTimeout(() => {
        testFile('/src/main.tsx', 'Original main.tsx');
      }, 1000);
    </script>

    <!-- IMPORTANT: Keep this for Lovable compatibility -->
    <script src="https://cdn.gpteng.co/gptengineer.js" type="module"></script>
  </body>
</html>
